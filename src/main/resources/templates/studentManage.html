<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <title>Manage</title>
    <link type="text/css" href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link type="text/css" href="/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link type="text/css" href="/css/fileinput.min.css" media="all" rel="stylesheet"/>
    <link type="text/css" href="/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
    <link type="text/css" href="/css/bootstrap-select.css" rel="stylesheet">
    <style>
        input[type="file"] {
            color: transparent;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row" style="height: 100px;background-color: #005521">
        <div class="col-lg-2" style="position: relative">
            <div style="padding-left: 15%;padding-top: 10%">
                <img class="img-circle" src="/images/icon.jpg" width="60px" height="60px"/>
                <label style="color: white;font-weight: normal">管理员</label>
            </div>


        </div>
        <div class="col-lg-3">
            <img src="/images/hbdx.jpg" style="width: 250px;height: 80px">
        </div>
        <div class="col-lg-7">
            <label style="text-align: center;padding-top:30px ;font-size: 25px;color:white;font-family: STKaiti">学生成绩管理系统</label>
        </div>
    </div>
    <div class="row" style="height: 653px">
        <div class="col-lg-2" style="height: 653px;width:15%;background-color: #005521">
            <ul class="nav nav-pills nav-stacked">
                <li role="presentation"><a style="color: white" href="/Admin/manage">课程管理</a></li>
                <li role="presentation"><a style="color: white" href="/Admin/studentManage">学生管理</a></li>
                <li role="presentation"><a style="color: white" href="/Admin/teacherManage">教师管理</a></li>
                <li role="presentation"><a style="color: white" href="/Admin/courseAttribute">课程分配</a></li>
                <li role="presentation"><a style="color: white" href="#">个人中心</a></li>
                <li role="presentation"><a style="color: white" href="#">关于</a></li>
            </ul>
        </div>
        <div class="col-lg-10" style="height: 653px;width:85%">
            <br><br>
            <div id="toolbar">
                <div class="btn btn-primary" data-toggle="modal" data-target="#studentModal"
                     onclick="var obj = document.getElementById('submitStudent');
						 obj.innerHTML='提交';
						 var obj1 = document.getElementById('myModalLabel');
						 obj1.innerHTML='新增学生';">
                    添加
                </div>
                <div class="btn btn-primary" id="deleteChoose">删除</div>
            </div>

            <div class="row" style="height: 50px;">
                <label class="col-lg-12" style="text-align: center;
					font-size: 20px;color:black;font-family: STKaiti;font-weight: bold">学生管理</label>
            </div>

            <div class="row" style="height: 623px">
                <table id="table"></table>
            </div>

            <div class="modal fade" id="studentModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="myModalLabel">新增学生</h4>
                        </div>
                        <div class="modal-body" style="height: 300px">
                            <div class="row" style="height: 30px;">
                                <label class="col-lg-3" style="padding-top: 5px;font-weight: normal;">
                                    <span style="float: right">姓名:</span>
                                </label>
                                <input class="col-lg-3" id="userRealName" name="userRealName"  style="float: left;height: 30px;width: 150px">

                                <label class="col-lg-2" style="font-weight: normal;padding-top: 5px;">
                                    <span style="float: right">学院:</span>
                                </label>
                                <div class="col-lg-4" style="width: 150px">
                                    <select class="selectpicker" id="studentDepartName" name="studentDepartName">
                                        <option>--请选择学院--</option>
                                    </select>
                                </div>

                            </div>

                            <div class="row" style="height: 30px;padding-top: 10px">


                                <label class="col-lg-3" style="padding-top: 5px;font-weight: normal;">
                                    <span style="float: right">户籍所在地:</span>
                                </label>
                                <input class="col-lg-3" id="studentNativePlace" name="studentNativePlace" style="float:left;height: 30px;width: 150px">
                                <label class="col-lg-2" style="padding-top: 5px;font-weight: normal;">
                                    <span style="float: right">性别:</span>
                                </label>
                                <div class="col-lg-4" style="width: 150px">
                                    <select class="selectpicker" id="studentGender" name="studentGender">
                                        <option value="男" selected>男</option>
                                        <option value="女">女</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row" style="height: 30px;padding-top: 20px">
                                <label class="col-lg-3" style="padding-top: 5px;font-weight: normal;">
                                    <span style="float: right">身份证号:</span>
                                </label>
                                <input class="col-lg-3" id="userIdCard" name="userIdCard" style="float: left;height: 30px;width: 150px;">

                                <label class="col-lg-2" style="font-weight: normal;padding-top: 5px;">
                                    <span style="float: right">政治面貌:</span>
                                </label>
                                <div class="col-lg-4" style="width: 150px">
                                    <select class="selectpicker" id="studentPoliticsStatus" name="studentPoliticsStatus">
                                        <option value="共青团员" selected>共青团员</option>
                                        <option value="共产党员">共产党员</option>
                                        <option value="群众">群众</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row" style="height: 30px;padding-top: 30px">
                                <label class="col-lg-3" style="font-weight: normal;padding-top: 5px;">
                                    <span style="float: right">联系电话:</span>
                                </label>
                                <input class="col-lg-3" id="studentPhoneNumber" name="studentPhoneNumber" style="height: 30px;width: 150px">
                            </div>
                            <label class="col-lg-2" style="padding-top: 5px;font-weight: normal;">
                                <span style="float: right">学生描述:</span>
                            </label>
                            <div class="col-lg-4" style="width: 150px">
                                <select class="selectpicker" id="studentNote" name="studentNote">
                                    <option value="优秀学生" selected>优秀学生</option>
                                    <option value="学生" selected>学生</option>
                                </select>
                            </div>
                            <label id="forIndex" style="display: none"></label>


                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" id="submitStudent" onclick="submitStudent()">提交</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script type="text/javascript" src="/lib/jquery-3.5.0.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/bootstrap-table.min.js"></script>
<script type="text/javascript" src="/js/fileinput.min.js"></script>
<script type="text/javascript" src="/js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="/js/bootstrap-datetimepicker.fr.js"></script>
<script type="text/javascript" src="/js/bootstrap-select.js"></script>
<script type="text/javascript" src="/js/jquery.form.min.js"></script>
<script type="text/javascript" src="/js/bootbox.min.js"></script>

<!--表格渲染-->
<script>
    $(document).ready(function () {
        var table = $('#table').bootstrapTable({
            url: "/Student/students/all/studentDepartId/1/0/0",
            striped: true,//隔行显示颜色
            showRefresh: true,//刷新按钮
            buttonsAlign: "left",//按钮对齐方式
            search: true,//是否搜索
            searchAlign: "left",//查询框对齐方式
            toolbar: "#toolbar",//指定工具栏
            toolbarAlign: "right",//工具栏对齐方式
            pageSize: 5,//每页显示的行数
            pageList: [5, 10],
            page: 1,//起始页数
            pagination: true,// 是否分页
            // 表格数据来源
            columns: [
                {
                    title: "全选",
                    field: "select",
                    checkbox: true,
                    width: 20,//宽度
                    align: "center",//水平
                    valign: "middle"//垂直
                },
                {
                    field: 'studentCode',
                    title: '学号'
                }, {
                    field: 'studentRealName',
                    title: '学生姓名'
                }, {
                    field: 'studentGender',
                    title: '性别'
                }, {
                    field: 'studentDepartName',
                    title: '学院'
                }, {
                    field: 'studentCreditSum',
                    title: '学分总数'
                }, {
                    field: 'studentIdCard',
                    title: '身份证号'
                }, {
                    field: 'studentPoliticsStatus',
                    title: '政治面貌'
                }, {
                    field: 'studentEntryTime',
                    title: '入学时间'
                }, {
                    field: '',
                    title: '管理',
                    halign:'center',
                    align:'center',
                    width:'100px',
                    formatter: function (value, row, index) {
                        return '<button class="btn btn-primary" id="modifyOne" data-toggle="modal" data-target="#studentModal"' +
                            'onclick="var obj = document.getElementById(\'submitStudent\');' +
                            'obj.innerHTML=\'修改\';' +
                            'var obj1 = document.getElementById(\'myModalLabel\');\n' +
                            '\t\t\t\t\t\t obj1.innerHTML=\'修改学生信息\';' +
                            'var obj2 = document.getElementById(\'forIndex\');\n' +
                            'obj2.innerHTML =\'' + index + '\'">修改</button>';
                    },
                }
            ]
        });

        $($.parseHTML(this.linkTemplate, document, true)).appendTo(table);

        $("#deleteChoose").on("click", function() {
            if (!confirm("是否确认删除？"))
                return;
            var rows = $("#table").bootstrapTable('getSelections');// 获得要删除的数据
            if (rows.length == 0) {// rows 主要是为了判断是否选中，下面的else内容才是主要
                alert("请先选择要删除的记录!");
            } else {
                var studentIds = [];// 声明一个数组
                $(rows).each(function() {// 通过获得别选中的来进行遍历
                    studentIds.push(this.studentId);// cid为获得到的整条数据中的一列
                });
                console.log(studentIds);
                deleteMs(JSON.stringify(studentIds));
            }
        });
        function deleteMs(studentIds) {
            console.log(studentIds);
            $.ajax({
                url : "/Student/removeStudent",
                data : studentIds,
                type : "post",
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                dataType : "json",
                success : function(data) {
                    $('#table').bootstrapTable('refresh', {
                        url : '/Student/students/all/studentDepartId/1/0/0',
                        method: "get"
                    });
                    if(data == true){
                        alert("删除成功");
                    }else {
                        alert(data);
                    }
                }
            });
        }
    })
</script>
<!--下拉框数据渲染-->
<script>
    getDepartName();
    function getDepartName() {
        $('#studentGender').selectpicker({
            width: '150px',
            height: '30px'
        });
        $('#studentPoliticsStatus').selectpicker({
            width: '150px',
            height: '30px'
        });
        $('#studentNote').selectpicker({
            width: '150px',
            height: '30px'
        });
        $.ajax({
            url: "/Depart/departments/all/departId/1/0/0",//请求地址(控制器地址)
            type: "get",
            success: function (data) {
                for (var i = 0; i < data.length; i++) {
                    $('#studentDepartName').append("<option value=" + data[i].departName + ">" + data[i].departName + "</option>");
                    console.assert(data)
                }

                $('#studentDepartName').selectpicker({
                    width: '150px',
                    height: '30px'
                });
                $('#studentDepartName').selectpicker('refresh');
                $('#studentDepartName').selectpicker('render');
            }
        });
    }
</script>
<!--提交/修改学生信息并弹窗-->
<script>
    function submitStudent() {
        var userIdCard = document.getElementById("userIdCard").value;
        var userRealName= document.getElementById("userRealName").value;
        var studentDepartName = document.getElementById("studentDepartName").value;
        var studentGender= document.getElementById("studentGender").value;
        var studentNativePlace = document.getElementById("studentNativePlace").value;
        var studentPoliticsStatus= document.getElementById("studentPoliticsStatus").value;
        var studentPhoneNumber= document.getElementById("studentPhoneNumber").value;
        var studentNote= document.getElementById("studentNote").value;

        var fd = new window.FormData();  //通过FormData拼装数据
        fd.append("userIdCard", userIdCard);
        fd.append("userRealName", userRealName);
        fd.append("studentDepartName", studentDepartName);
        fd.append("studentGender", studentGender);
        fd.append("studentNativePlace", studentNativePlace);
        fd.append("studentPoliticsStatus", studentPoliticsStatus);
        fd.append("studentPhoneNumber", studentPhoneNumber);
        fd.append("studentNote", studentNote);

        var URL;
        var btTxt = document.getElementById("submitStudent").innerHTML;
        if(btTxt == "修改"){
            URL = "/Student/modifyStudent";
            var index = document.getElementById("forIndex").innerHTML;

            var courseRow = $("#table").bootstrapTable("getData")[index];
            var studentId = courseRow["studentId"];
            fd.append("studentId", studentId);
            fd.append("studentRealName", userRealName);
        }
        else if(btTxt == "提交"){
            URL = "/Student/newStudent";
        }


        console.log(fd);
        //通过ajax发送数据
        $.ajax({
            url: URL,
            type: "post",
            processData: false,
            contentType: false,
            enctype: "multipart/form-data",
            data: fd,
            success: function(result) {
                alert(result);
                if(result.indexOf("学生创建成功！") == -1){
                }
                else {
                    $('#studentModal').modal('hide');
                }
                if(result.indexOf("修改成功！") == -1){
                }
                else {
                    $('#studentModal').modal('hide');
                }
                $('#table').bootstrapTable('refresh', {
                    url : '/Student/students/all/studentDepartId/1/0/0',
                    method: "get"
                });
            }
        });
    }


</script>
</html>